{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Driver Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'school_transport/css/driver_dashboard.css' %}">

    <!-- PWA manifest -->
    <link rel="manifest" href="{% static 'pwa/manifest.json' %}">
    <meta name="theme-color" content="#800000">
</head>
<body class="dashboard-bg">

<div class="dashboard-card">

    <!-- Driver Info -->
    <div class="driver-header">
        {% if driver.profile_photo %}
            <img src="{{ driver.profile_photo.url }}" class="driver-photo">
        {% endif %}
        <h2>{{ driver.full_name }}</h2>
    </div>

    <!-- Driver Delivery Locations -->
    <div class="driver-locations">
        <h3>Delivery Locations</h3>
        {% for location in driver.delivery_locations %}
            <p>{{ location }}</p>
        {% empty %}
            <p>No locations assigned.</p>
        {% endfor %}
    </div>

    <!-- Assigned Children -->
    <h3>Assigned Children</h3>
    <div class="children-list">
        {% for child in children %}
        <div class="child-card" onclick="toggleDetails('child-{{ child.id }}')">
            {% if child.profile_photo %}
                <img src="{{ child.profile_photo.url }}" class="child-photo">
            {% endif %}
            <h4>{{ child.full_name }}</h4>
            <div id="child-{{ child.id }}" class="child-details">
                <p><strong>Class:</strong> {{ child.level }}</p>
                <p><strong>Residential Area:</strong> {{ child.residential_area }}</p>
                <p><strong>Teacher:</strong> {{ child.teacher }}</p>
                <p><strong>Guardian Phone:</strong> {{ child.guardian_phone }}</p>
            </div>
        </div>
        {% empty %}
            <p>No children assigned.</p>
        {% endfor %}
    </div>

    <a href="{% url 'driver_logout' %}" class="logout-btn">Logout</a>

</div>

<!-- Toggle JS -->
<script>
function toggleDetails(id){
    const elem = document.getElementById(id);
    if(elem.style.display === "none" || elem.style.display === ""){
        elem.style.display = "block";
    } else {
        elem.style.display = "none";
    }
}

// Register service worker for PWA
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register("{% static 'pwa/service-worker.js' %}");
}
</script>

</body>
</html>
